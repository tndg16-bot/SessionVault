# SessionVault - テスト手順

Chrome拡張機能のインストールから実際の会話保存までの手順説明です。

---

## 事前準備

### 1. Obsidianの準備

1. **Obsidianを開く**
   ```
   ターミナルまたはショートカットからObsidianを起動
   ```

2. **Local REST APIプラグインのインストール**
   1. 設定（左下の歯車アイコン）をクリック
   2. 「コミュニティプラグイン」をクリック
   3. 「制限モードをオフにする」をクリック
   4. 「閲覧」をクリック
   5. 検索ボックスに「**Local REST API**」と入力
   6. 表示されたプラグインの「**インストール**」をクリック
   7. インストール後、「**有効化**」スイッチをオン

3. **API設定の確認**
   - 設定 → コミュニティプラグイン → Local REST API
   - 「**Enable Non-encrypted (HTTP) Server**」を**オン**
   - ポート: `27123` であることを確認

4. **APIキーの確認**
   - 同じ設定画面に表示されるAPIキーをコピー
   - 例: `e02a92151916c4bad4894534f03c58f745d44bf5fa6e0c21fe77c8dd6acce56e`
   - このキーはあとで拡張機能の設定に入力します

### 2. Ollamaの準備（要約機能を使う場合）

**Ollamaはまだインストール済みです。**

1. **Ollamaが起動しているか確認**
   ```
   ターミナルで実行:
   curl http://localhost:11434/api/tags
   
   正常なら以下のような応答が返ってきます:
   {"models":[{"name":"llama3:latest",...}]}
   ```

2. **利用可能なモデルの確認**
   ```
   現在インストールされているモデル:
   - llama3:latest
   - qwen2.5:7b
   - gemma3:1b
   - その他...
   ```

---

## Chrome拡張機能のインストール

### 手順1: 拡張機能を読み込む

1. **Chromeを開く**

2. **拡張機能管理画面を開く**
   ```
   アドレスバーに以下を入力してEnter:
   chrome://extensions/
   ```

3. **デベロッパーモードを有効化**
   - 右上の「**デベロッパーモード**」スイッチを**オン**
   ※ オフの場合、パッケージ化されていない拡張機能は読み込めません

4. **拡張機能を読み込む**
   - 左上の「**パッケージ化されていない拡張機能を読み込む**」ボタンをクリック
   - ファイル選択ダイアログが開きます
   - 以下のフォルダを選択:
     ```
     C:\Users\chatg\Obsidian Vault\papa\Apps\Tools\SessionVault
     ```
   - 「**フォルダーの選択**」をクリック

5. **インストール完了の確認**
   - 拡張機能一覧に「**SessionVault - AI Chat to Obsidian**」が表示されればOK
   - エラーが表示される場合は、パスが間違っている可能性があります

---

## 拡張機能の初期設定

### 手順2: 設定を入力する

1. **SessionVaultの設定画面を開く**
   - Chromeツールバーのパズルピース（または拡張機能アイコン）をクリック
   - ポップアップが開きます

2. **設定を入力**
   以下の項目を確認・入力してください:

   | 項目 | 入力値 | 説明 |
   |--------|---------|--------|
   | Vault名 | `papa-notes` | Obsidianの保管庫名 |
   | 保存先フォルダ | `SessionVault-logs` | 保存先のフォルダパス |
   | Ollama API | `http://localhost:11434` | Ollamaのエンドポイント |
   | Ollamaモデル | `gemma3:1b` | 使用するモデル名 |

3. **オプションの選択**
   - `要約を生成`: オン（会話を要約する場合）
   - `Mermaid図を生成`: オフ（最初はオフ推奨）
   - `保存前にプレビュー`: オン（保存内容を確認する場合）

4. **設定を保存**
   - 「**設定を保存**」ボタンをクリック
   - ステータスが「**設定を保存しました**」になればOK

---

## テスト実行: ChatGPTでの会話保存

### 手順3: ChatGPTで会話を保存する

1. **ChatGPTを開く**
   ```
   https://chatgpt.com
   ```

2. **ログイン**
   - 既にログイン済みであればスキップ
   - 未ログインの場合はログインしてください

3. **テスト用の会話を作成**
   - 以下のような短い会話でテスト推奨:
   
   **User**:
   ```
   JavaScriptの配列から最大値を取得する方法を教えて
   ```
   
   **Assistant**:
   ```
   Math.max()メソッドを使用します。
   
   例:
   const numbers = [1, 5, 3, 9, 2];
   const max = Math.max(...numbers);
   console.log(max); // 9
   ```

4. **拡張機能を開く**
   - ChromeツールバーのSessionVaultアイコンをクリック
   - ポップアップが開きます

5. **ステータスの確認**
   - 「**ChatGPT - 準備完了**」と表示されればOK
   - 「**対応サイトではありません**」と表示される場合は、ChatGPTのページをリロードしてください

6. **会話を取得**
   - 「**会話を取得**」ボタンをクリック
   - ステータスが「**X件のメッセージを取得**」に変わります

7. **プレビューの確認**（プレビュー機能がオンの場合）
   - プレビューセクションが表示されます
   - 取得された会話の最初の数件が表示されます
   - 内容を確認して、問題なければ進みます

8. **Obsidianに保存**
   - 「**Obsidianに保存**」ボタンをクリック
   - ステータスが「**Obsidianに保存中...**」になります

9. **完了の確認**
   - ステータスが「**保存完了!**」になれば成功
   - エラーが表示された場合は、以下のトラブルシューティングを確認

---

## 保存結果の確認

### 手順4: Obsidianで保存されたファイルを確認

1. **Obsidianを開く**（最小化されている場合は復元）

2. **保存されたファイルを見つける**
   - 左のファイルエクスプローラーで以下のフォルダを開く:
     ```
     SessionVault-logs/
     ```
   - 今日の日付のファイル（例: `2025-01-15_ChatGPT_テスト.md`）があるはずです

3. **ファイルを開く**
   - ファイルをダブルクリックして内容を確認

4. **内容の確認**
   ファイルは以下の構成になっているはず:
   
   ```markdown
   ---
   source: ChatGPT
   url: [ChatGPTのURL]
   created: [日時]
   tags: [ai-chat, chatgpt]
   ---
   
   # [会話のタイトル]
   
   ## 要約
   
   [要約テキスト - 要約機能がオンの場合]
   
   ## 会話ログ
   
   🔗 元のチャット: [URL]
   
   ### **User**
   
   [ユーザーの質問]
   
   ---
   
   ### **Assistant**
   
   [AIの応答]
   
   ---
   
   ```

---

## 更新確認機能のテスト（オプション）

### 手順5: 拡張機能の更新確認

1. **拡張機能のポップアップを開く**

2. **「更新確認」リンクをクリック**
   - フッターの「更新確認」をクリック

3. **結果の確認**
   - 「**最新バージョンを使用中**」と表示されればOK
   - 「**新しいバージョン v1.0.1 があります！**」と表示される場合は、GitHubのリリースを確認

---

## トラブルシューティング

### 問題1: 拡張機能が読み込めない

**症状**: chrome://extensions/で「パッケージ化されていない拡張機能を読み込む」をクリックしても何も起きない、またはエラー

**原因**:
- フォルダパスが間違っている
- manifest.jsonの構文エラー

**解決策**:
1. パスが正しいか確認: `C:\Users\chatg\Obsidian Vault\papa\Apps\Tools\SessionVault`
2. manifest.jsonを開いて、カッコなどのバランスを確認
3. Chromeの拡張機能エラー画面（chrome://extensions/errors/）でエラー詳細を確認

### 問題2: 「会話を取得」が効かない

**症状**: ボタンをクリックしても反応がない

**原因**:
- Content Scriptが読み込まれていない
- ページが完全にロードされていない

**解決策**:
1. ChatGPTのページを**リロード**（F5またはCtrl+R）
2. 拡張機能を**再読み込み**（chrome://extensions/で更新ボタンをクリック）
3. ページが完全に読み込まれてから、もう一度試す

### 問題3: 要約が生成されない

**症状**: 要約の箇所が空になっている、または「(要約の生成に失敗しました)」と表示される

**原因**:
- Ollamaが起動していない
- モデル名が間違っている
- 通信エラー

**解決策**:
1. Ollamaが起動しているか確認:
   ```
   curl http://localhost:11434/api/tags
   ```
2. 拡張機能の設定で「Ollamaモデル」が`gemma3:1b`であるか確認
3. 要約機能をオフにして、まず会話だけ保存できるか確認
4. ブラウザのConsole（F12）でエラーメッセージを確認

### 問題4: Obsidianに保存できない

**症状**: 「保存失敗: REST API error: 401」等のエラー

**原因**:
- ObsidianのLocal REST APIが有効になっていない
- APIキーが間違っている
- Obsidianが開いていない

**解決策**:
1. ObsidianのLocal REST API設定画面を開く
2. 「**Enable Non-encrypted (HTTP) Server**」が**オン**か確認
3. 表示されているAPIキーをコピー
4. 拡張機能の設定で「Obsidian APIキー」を更新
5. Obsidianが開いていることを確認

---

## テストチェックリスト

以下を全てチェックして、すべてOKであれば成功です：

- [ ] Chrome拡張機能が正常に読み込まれている
- [ ] 拡張機能の設定が保存できる
- [ ] ChatGPTページで「準備完了」と表示される
- [ ] 「会話を取得」でメッセージ数が表示される
- [ ] プレビューで会話内容が確認できる
- [ ] 「Obsidianに保存」が正常に完了する
- [ ] Obsidianにファイルが保存されている
- [ ] 保存されたファイルの内容が正しい
- [ ] 要約機能が動作している（オンの場合）
- [ ] 更新確認機能が動作している

---

## 次のステップ

テストが完了したら、次は以下のどちらか進みます：

1. **他のAIサービスでテスト**
   - Claude.aiでの会話保存を試す
   - Gemini.google.comでの会話保存を試す
   - Google AI Studioでの会話保存を試す

2. **TermLogのテスト**
   - CLIツールでの会話保存を試す

3. **追加機能の実装**
   - Mermaid図の生成ロジックの改善
   - より高度な抽出ロジックの実装
   - UIの改善

何を進みますか？
